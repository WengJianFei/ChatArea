!function(){function e(){"use strict";/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */e=function(){return i};var t,i={},n=Object.prototype,r=n.hasOwnProperty,a=Object.defineProperty||function(e,t,i){e[t]=i.value},o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",l=o.toStringTag||"@@toStringTag";function d(e,t,i){return Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{d({},"")}catch(t){d=function(e,t,i){return e[t]=i}}function u(e,t,i,n){var r=t&&t.prototype instanceof x?t:x,o=Object.create(r.prototype),s=new M(n||[]);return a(o,"_invoke",{value:A(e,i,s)}),o}function p(e,t,i){try{return{type:"normal",arg:e.call(t,i)}}catch(e){return{type:"throw",arg:e}}}i.wrap=u;var f="suspendedStart",m="suspendedYield",g="executing",v="completed",y={};function x(){}function E(){}function b(){}var k={};d(k,s,(function(){return this}));var C=Object.getPrototypeOf,w=C&&C(C(D([])));w&&w!==n&&r.call(w,s)&&(k=w);var N=b.prototype=x.prototype=Object.create(k);function T(e){["next","throw","return"].forEach((function(t){d(e,t,(function(e){return this._invoke(t,e)}))}))}function L(e,t){function i(n,a,o,s){var c=p(e[n],e,a);if("throw"!==c.type){var l=c.arg,d=l.value;return d&&"object"==h(d)&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return i("throw",e,o,s)}))}s(c.arg)}var n;a(this,"_invoke",{value:function(e,r){function a(){return new t((function(t,n){i(e,r,t,n)}))}return n=n?n.then(a,a):a()}})}function A(e,i,n){var r=f;return function(a,o){if(r===g)throw Error("Generator is already running");if(r===v){if("throw"===a)throw o;return{value:t,done:!0}}for(n.method=a,n.arg=o;;){var s=n.delegate;if(s){var c=I(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===f)throw r=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=g;var l=p(e,i,n);if("normal"===l.type){if(r=n.done?v:m,l.arg===y)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=v,n.method="throw",n.arg=l.arg)}}}function I(e,i){var n=i.method,r=e.iterator[n];if(r===t)return i.delegate=null,"throw"===n&&e.iterator.return&&(i.method="return",i.arg=t,I(e,i),"throw"===i.method)||"return"!==n&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=p(r,e.iterator,i.arg);if("throw"===a.type)return i.method="throw",i.arg=a.arg,i.delegate=null,y;var o=a.arg;return o?o.done?(i[e.resultName]=o.value,i.next=e.nextLoc,"return"!==i.method&&(i.method="next",i.arg=t),i.delegate=null,y):o:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,y)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function O(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function D(e){if(e||""===e){var i=e[s];if(i)return i.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function i(){for(;++n<e.length;)if(r.call(e,n))return i.value=e[n],i.done=!1,i;return i.value=t,i.done=!0,i};return a.next=a}}throw new TypeError(h(e)+" is not iterable")}return E.prototype=b,a(N,"constructor",{value:b,configurable:!0}),a(b,"constructor",{value:E,configurable:!0}),E.displayName=d(b,l,"GeneratorFunction"),i.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===E||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,d(e,l,"GeneratorFunction")),e.prototype=Object.create(N),e},i.awrap=function(e){return{__await:e}},T(L.prototype),d(L.prototype,c,(function(){return this})),i.AsyncIterator=L,i.async=function(e,t,n,r,a){void 0===a&&(a=Promise);var o=new L(u(e,t,n,r),a);return i.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},T(N),d(N,l,"Generator"),d(N,s,(function(){return this})),d(N,"toString",(function(){return"[object Generator]"})),i.keys=function(e){var t=Object(e),i=[];for(var n in t)i.push(n);return i.reverse(),function e(){for(;i.length;){var n=i.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},i.values=D,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(O),!e)for(var i in this)"t"===i.charAt(0)&&r.call(this,i)&&!isNaN(+i.slice(1))&&(this[i]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var i=this;function n(n,r){return s.type="throw",s.arg=e,i.next=n,r&&(i.method="next",i.arg=t),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!l)throw Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&r.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.finallyLoc===e)return this.complete(i.completion,i.afterLoc),O(i),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var i=this.tryEntries[t];if(i.tryLoc===e){var n=i.completion;if("throw"===n.type){var r=n.arg;O(i)}return r}}throw Error("illegal catch attempt")},delegateYield:function(e,i,n){return this.delegate={iterator:D(e),resultName:i,nextLoc:n},"next"===this.method&&(this.arg=t),y}},i}function t(e,t,i){return(t=s(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function i(e,t,i,n,r,a,o){try{var s=e[a](o),c=s.value}catch(l){return void i(l)}s.done?t(c):Promise.resolve(c).then(n,r)}function n(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,c,"next",e)}function c(e){i(o,r,a,s,c,"throw",e)}s(void 0)}))}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function o(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e){var t=function(e,t){if("object"!=h(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==h(t)?t:t+""}function c(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);"Object"===i&&e.constructor&&(i=e.constructor.name);if("Map"===i||"Set"===i)return Array.from(e);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(e,t)}(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==i.return||i.return()}finally{if(s)throw a}}}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}System.register([],(function(i,a){"use strict";return{execute:function(){var a=Object.defineProperty,s=function(e,t,i){return function(e,t,i){t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i}(e,"symbol"!=h(t)?t+"":t,i),i};!function(){var e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){var t,i=c(document.querySelectorAll('link[rel="modulepreload"]'));try{for(i.s();!(t=i.n()).done;){n(t.value)}}catch(r){i.e(r)}finally{i.f()}new MutationObserver((function(e){var t,i=c(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if("childList"===a.type){var o,s=c(a.addedNodes);try{for(s.s();!(o=s.n()).done;){var l=o.value;"LINK"===l.tagName&&"modulepreload"===l.rel&&n(l)}}catch(r){s.e(r)}finally{s.f()}}}}catch(r){i.e(r)}finally{i.f()}})).observe(document,{childList:!0,subtree:!0})}function n(e){if(!e.ep){e.ep=!0;var t=function(e){var t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}}();var l=function(){return o((function e(t){r(this,e),s(this,"richText"),s(this,"vnode"),s(this,"cursorIndex"),s(this,"cursorLeft"),s(this,"needCallSpace",!1),s(this,"VOID_KEY","\ufeff"),s(this,"ZERO_WIDTH_KEY","​"),s(this,"pointEndIME"),s(this,"IME_KEY","​_"),this.richText=t,this.textInnerHtmlInit(),this.richText.focus()}),[{key:"textInnerHtmlInit",value:function(){var e=arguments.length>1?arguments[1]:void 0;if(arguments.length>0&&void 0!==arguments[0]&&arguments[0]||this.getNodeEmpty(this.richText)){this.richText.innerHTML="";var t=this.getGridElm();this.richText.appendChild(t);var i=t.children[0].children[0];e&&(i.innerHTML=e,i.setAttribute("data-set-empty","false"));var n=i.childNodes[0];this.restCursorPos(n,n.textContent===this.VOID_KEY?1:n.textContent.length)}}},{key:"onceCall",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return new Promise((function(r){var a=t.createAtUserSpan(e);r(t.replaceRegContent(a,!0,i,n)||"")}))}},{key:"searchCall",value:function(e,t){var i=this;return new Promise((function(n){var r=i.createAtUserSpan(e);i.replaceRegContent(r,t),n()}))}},{key:"onceExternalCall",value:function(e){var t=this;return new Promise((function(i){var n=t.createAtUserSpan(e);i(t.replaceRegContent(n,!1,!0)||"")}))}},{key:"upDataNodeOrIndex",value:function(){var e,t,i,n=window.getSelection(),r=n.focusNode,a=n.focusOffset,o=n.anchorOffset,s=(null==r?void 0:r.parentNode)||void 0;!s||!s.getAttribute||"richInput"!==s.getAttribute("data-set-richType")||(null==(i=null==(t=null==(e=null==r?void 0:r.parentNode)?void 0:e.parentNode)?void 0:t.parentNode)?void 0:i.parentNode)!==this.richText||(this.vnode=r,this.cursorIndex=a,this.cursorLeft=o<a?o:a)}},{key:"showAt",value:function(){if(this.upDataNodeOrIndex(),!this.vnode||this.vnode.nodeType!==Node.TEXT_NODE)return!1;var e=(this.vnode.textContent||"").slice(0,this.cursorIndex),t=/@([^@\s]*)$/.exec(e);return t&&2===t.length&&"@"===e[e.length-1]}},{key:"getRangeRect",value:function(){var e=0,t=0,i=window.getSelection().getRangeAt(0).getClientRects()[0];return i&&(e=i.x,t=i.y),{x:e,y:t}}},{key:"createAtUserSpan",value:function(e){var t=document.createElement("span");return t.dataset.userId=String(e.id),t.className="at-user",t.contentEditable="false",t.textContent="@".concat(e.name).concat(this.needCallSpace?" ":""),this.createNewDom(t)}},{key:"createNewDom",value:function(e){var t=document.createElement("span");return t.className="chat-tag",t.setAttribute("contenteditable","false"),t.setAttribute("data-set-richType","chatTag"),e.className+=" chat-stat",t.appendChild(e),t}},{key:"restCursorPos",value:function(e,t){null==t?t=e.textContent===this.VOID_KEY?1:0:t>e.textContent.length&&(t=e.textContent.length);var i=new Range;i.setStart(e,t),i.setEnd(e,t);var n=window.getSelection();n&&(this.vnode=e,this.cursorIndex=t,this.cursorLeft=t,n.removeAllRanges(),n.addRange(i))}},{key:"setCursorPos",value:function(e,t){var i=window.getSelection();if(!(i.rangeCount<=0)){var n=i.getRangeAt(0);n.setStart(e,t),n.collapse(!0),this.vnode=e,this.cursorIndex=t,this.cursorLeft=t}}},{key:"replaceRegContent",value:function(e){var t,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=this.vnode.textContent;0===(t="boolean"==typeof i?a.slice(0,i?this.cursorIndex-1:this.cursorIndex):a.slice(0,i-1)).length?(this.vnode.parentElement.setAttribute("data-set-empty",!0),this.vnode.textContent=this.VOID_KEY):this.vnode.textContent=t;var o=r||a.slice(this.cursorIndex),s=this.vnode.parentNode.parentNode,c=s.nextSibling;c?s.parentNode.insertBefore(e,c):s.parentNode.appendChild(e);var l=e.previousSibling.childNodes[0],h=l.childNodes[1];h&&l.removeChild(h);var d=this.getGridElm(!0),u=d.childNodes[0];!n&&o&&o!==this.VOID_KEY&&(u.setAttribute("data-set-empty","false"),u.innerHTML=o);var p=u.childNodes[1];return n&&p&&u.removeChild(p),e.nextSibling?(p&&u.removeChild(p),s.parentNode.insertBefore(d,e.nextSibling)):s.parentNode.appendChild(d),this.restCursorPos(u.childNodes[0]),o}},{key:"switchRange",value:function(e){var t,i,n,r,a=window.getSelection(),o=a.focusNode,s=a.focusOffset;if(o.nodeType===Node.TEXT_NODE){var c=o.textContent.length,l=o.parentNode.parentNode;switch(e){case"ArrowLeft":if(s>0&&o.textContent!==this.VOID_KEY){r=s-1,n=o;break}var h=null==(t=null==l?void 0:l.previousSibling)?void 0:t.previousSibling;if(h)r=(n=h.childNodes[0].childNodes[0]).textContent.length;else{var d=l.parentNode.previousSibling;d&&(r=(n=d.lastChild.childNodes[0].childNodes[0]).textContent.length)}break;case"ArrowRight":if(s<c&&o.textContent!==this.VOID_KEY){r=s+1,n=o;break}var u=null==(i=null==l?void 0:l.nextSibling)?void 0:i.nextSibling;if(u)r=(n=u.childNodes[0].childNodes[0]).textContent===this.VOID_KEY?1:0;else{var p=l.parentNode.nextSibling;p&&(r=(n=p.childNodes[0].childNodes[0].childNodes[0]).textContent===this.VOID_KEY?1:0)}}}(r||0===r)&&this.restCursorPos(n,r)}},{key:"getGridElm",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=document.createElement("span");if(t.setAttribute("data-set-richType","richMark"),t.innerHTML='<span class="chat-grid-input chat-stat" data-set-richType="richInput" data-set-empty="true">'.concat(this.VOID_KEY,"<br></span>"),e)return t;var i=document.createElement("p");return i.className="chat-grid-wrap",i.setAttribute("data-set-richType","richBox"),i.appendChild(t),i}},{key:"updateGrid",value:function(){var e,t,i,n,r=this,a=window.getSelection(),o=a.focusNode,s=o.parentNode;switch(s.getAttribute("data-set-richType")){case"richAllBox":if(!(e=o.childNodes[a.focusOffset])||"chatTag"===e.getAttribute("data-set-richType")){var c=this.getGridElm(!0),l=c.children[0];e?(l.removeChild(l.childNodes[1]),o.insertBefore(c,e)):o.appendChild(c),this.restCursorPos(l.childNodes[0]);break}if("BR"===e.tagName){var h=this.getGridElm(!0),d=h.children[0];o.insertBefore(h,e),o.removeChild(e),this.restCursorPos(d.childNodes[0],d.childNodes[0].textContent.length)}break;case"richMark":var u=s.parentNode,p=Array.prototype.indexOf.call(u.childNodes,s);if(-1===p)break;if(0===p){var f=a.focusNode;f.setAttribute("data-set-empty","true"),f.innerHTML="".concat(this.VOID_KEY,"<br>"),e=f.childNodes[0],this.restCursorPos(e,e.textContent.length);break}var m,g=s.previousSibling;"chatTag"===g.getAttribute("data-set-richType")?(m=g.previousSibling,u.removeChild(g),u.removeChild(s)):(m=s.previousSibling,u.removeChild(s)),(e=m.childNodes[0].childNodes[0]).textContent===this.VOID_KEY&&e.parentNode.appendChild(document.createElement("br")),this.restCursorPos(e,e.textContent.length);break;case"richInput":if(i=(n=s.parentNode).parentNode,this.getNodeEmpty(s)){s.setAttribute("data-set-empty","true"),i.childNodes[i.childNodes.length-1]===n&&(s.innerHTML="".concat(this.VOID_KEY,"<br>")),e=s.childNodes[0],this.restCursorPos(e,e.textContent.length);break}if("true"===String(s.getAttribute("data-set-empty"))){s.setAttribute("data-set-empty","false");var v=[],y=[];Array.prototype.forEach.call(s.childNodes,(function(e){e.nodeType===Node.TEXT_NODE&&-1!==e.textContent.indexOf(r.VOID_KEY)?y.push(e):"BR"===e.tagName&&v.push(e)})),v.forEach((function(e){s.removeChild(e)})),y.forEach((function(e){var t=e.textContent.indexOf(r.VOID_KEY),i=new Range;i.setStart(e,e.textContent.indexOf(r.VOID_KEY)),i.setEnd(e,t+1),i.deleteContents()})),e=s.childNodes[0],this.restCursorPos(e,e.textContent.length)}if((t=s.parentNode.nextSibling)&&t.nodeType===Node.TEXT_NODE){var x=t.textContent,E=this.getGridElm(!0);E.childNodes[0].textContent=x,E.childNodes[0].setAttribute("data-set-empty","false"),t.parentNode.insertBefore(E,t),t.parentNode.removeChild(t),t=E}t&&"richMark"===t.getAttribute("data-set-richType")&&this.markMerge(s.parentNode,t)}}},{key:"getNodeEmpty",value:function(e){var t=new RegExp("^(".concat(this.ZERO_WIDTH_KEY,"|<br>|").concat(this.VOID_KEY,")+$"));return!e.innerHTML||t.test(e.innerHTML)}},{key:"setWrap",value:function(){var e=window.getSelection(),t=e.focusNode,i=e.focusOffset;if(t.nodeType!==Node.TEXT_NODE){if(!t.getAttribute||"richInput"!==t.getAttribute("data-set-richType"))return;t=t.childNodes[0]}var n=t.textContent.slice(i),r=t.parentNode.parentNode,a=r.parentNode,o=Array.prototype.indexOf.call(a.childNodes,r),s=Array.prototype.slice.call(a.childNodes,o+1),c=this.getGridElm(),l=c.children[0].children[0].childNodes[0],h=1;(n||s.length>0)&&l.parentNode.removeChild(l.parentNode.childNodes[1]),n&&n!==this.VOID_KEY&&(t.textContent=t.textContent.slice(0,i),l.textContent=(l.textContent+n).replace(new RegExp(this.VOID_KEY,"g"),(function(){return h--,""})),l.parentElement.setAttribute("data-set-empty","false")),s.forEach((function(e){a.removeChild(e),c.appendChild(e)}));var d=a.lastChild.childNodes[0],u=c.lastChild.childNodes[0];if(d.childNodes.length<=1){var p=d.childNodes[0];(!p.textContent||p.textContent===this.VOID_KEY)&&(d.innerHTML="".concat(this.VOID_KEY,"<br>"),d.setAttribute("data-set-empty","true"))}if("richMark"!==u.parentElement.getAttribute("data-set-richType"))c.appendChild(this.getGridElm(!0));else if(u.childNodes.length<=1){var f=u.childNodes[0];(!f.textContent||f.textContent===this.VOID_KEY)&&(u.innerHTML="".concat(this.VOID_KEY,"<br>"),u.setAttribute("data-set-empty","true"),l=c.children[0].children[0].childNodes[0])}a.nextSibling?this.richText.insertBefore(c,a.nextSibling):this.richText.appendChild(c),this.restCursorPos(l,l.textContent===this.VOID_KEY?1:h),this.viewIntoPoint()}},{key:"selectRegionMerge",value:function(){var e=window.getSelection();if(!(e.isCollapsed||e.rangeCount<=0)){var t=e.getRangeAt(0);if(t.startContainer.nodeType===Node.TEXT_NODE&&t.startContainer===t.endContainer){var i=t.startContainer;if(i.length===t.endOffset-t.startOffset){var n=i.parentNode,r=n.parentNode===n.parentNode.parentNode.lastChild;n.setAttribute("data-set-empty","true"),n.innerHTML="\ufeff".concat(r?"<br>":""),this.restCursorPos(n.childNodes[0])}else t.deleteContents()}else if(t.commonAncestorContainer&&"richBox"===t.commonAncestorContainer.getAttribute("data-set-richType")){var a=t.startContainer.nodeType===Node.TEXT_NODE?t.startContainer.parentNode.parentNode:t.startContainer,o=t.endContainer.nodeType===Node.TEXT_NODE?t.endContainer.parentNode.parentNode:t.endContainer;t.deleteContents(),a.getAttribute("data-set-richType")===o.getAttribute("data-set-richType")&&this.markMerge(a,o)}else if(t.commonAncestorContainer===t.startContainer&&t.startContainer===t.endContainer)this.textInnerHtmlInit(!0);else{var s=function(e){if(e.nodeType===Node.TEXT_NODE)return e.parentNode.parentNode.parentNode;switch(e.getAttribute("data-set-richType")){case"richInput":return e.parentNode.parentNode;case"richMark":return e.parentNode;case"richBox":return e;default:return null}},c=s(t.startContainer),l=s(t.endContainer);if(!c||!l)return;t.deleteContents(),this.gridMerge(c,l)}return!0}}},{key:"gridElmMerge",value:function(){var e=this,t=window.getSelection(),i=t.focusNode,n=t.focusOffset,r=t.isCollapsed;if(n>1||!r)return!1;var a=function t(i,n){return(i.parentNode===e.richText||i===i.parentNode.childNodes[0])&&(-1!==Array.prototype.indexOf.call(e.richText.childNodes,i)?i:!(n>=6)&&t(i.parentNode,n+1))}(i,0);if(!a||a===this.richText.childNodes[0]||1===n&&"false"===a.children[0].children[0].getAttribute("data-set-empty"))return!1;var o=a.previousSibling;return this.gridMerge(o,a),!0}},{key:"delMarkRule",value:function(){var e=window.getSelection(),t=e.focusNode,i=t.textContent,n=t.parentNode,r=n.parentNode,a=r.parentNode;if(!e.isCollapsed||"richInput"!==n.getAttribute("data-set-richType"))return!1;if(i&&1===i.length&&r!==a.childNodes[0]&&(0!==e.focusOffset||i===this.VOID_KEY)){if(i===this.VOID_KEY){var o=r.previousSibling.previousSibling;a.removeChild(r.previousSibling),a.removeChild(r);var s=o.childNodes[0],c=s.childNodes[0];c.textContent===this.VOID_KEY&&o===a.lastChild&&s.appendChild(document.createElement("br")),this.restCursorPos(c,c.textContent.length)}else{n.innerHTML=r===a.lastChild?"".concat(this.VOID_KEY,"<br>"):this.VOID_KEY,n.setAttribute("data-set-empty","true");var l=n.childNodes[0];this.restCursorPos(l,1)}return!0}if(0===e.focusOffset){var h=n.parentNode,d=null==h?void 0:h.previousSibling;return!(!d||"chatTag"!==d.getAttribute("data-set-richType"))&&(this.delTag(d),!0)}}},{key:"setIMESelection",value:function(){var e=window.getSelection(),t=e.focusNode,i=t.parentNode.parentNode;"richMark"===((null==i?void 0:i.getAttribute("data-set-richType"))||"")&&(this.pointEndIME=e.focusOffset,t.textContent=t.textContent.slice(0,this.pointEndIME)+this.IME_KEY+t.textContent.slice(this.pointEndIME),this.restCursorPos(t,this.pointEndIME+this.IME_KEY.length))}},{key:"delMarkRuleIME",value:function(){var e=window.getSelection(),t=e.focusNode,i=t.parentNode,n=i.parentNode;if("richMark"===((null==n?void 0:n.getAttribute("data-set-richType"))||"")){this.pointEndIME=e.focusOffset;var r=new RegExp(this.IME_KEY.slice(0,-1),"g");if(t.textContent=t.textContent.replace(r,""),this.pointEndIME>this.IME_KEY.length-1&&t.textContent!==this.VOID_KEY){var a=this.pointEndIME-(this.IME_KEY.length-1);t.textContent=t.textContent.slice(0,a-1)+t.textContent.slice(a),this.setCursorPos(t,a-1)}else{if("false"===i.getAttribute("data-set-empty")&&(""===t.textContent||t.textContent===this.VOID_KEY)){i.innerHTML=n===n.parentElement.lastChild?"".concat(this.VOID_KEY,"<br>"):this.VOID_KEY,i.setAttribute("data-set-empty","true");var o=i.childNodes[0];return void this.setCursorPos(o,1)}var s=n.previousSibling;if(s&&s.getAttribute&&"chatTag"===s.getAttribute("data-set-richType"))return void this.delTag(s);var c=n.parentElement,l=c.previousElementSibling;l&&this.gridMerge(l,c)}}}},{key:"wrapIME",value:function(){var e=window.getSelection().focusNode;if(e.getAttribute&&"richBox"===e.getAttribute("data-set-richType")){var t=e.previousSibling.lastChild.children[0].childNodes[0];t.textContent=t.textContent.slice(0,-this.IME_KEY.length);var i=e.children[0];"BR"===i.tagName&&e.removeChild(i)}else{var n=e.parentNode.parentNode,r=(null==n?void 0:n.getAttribute("data-set-richType"))||"";if("richMark"===r){var a=n.parentElement.previousSibling.lastChild.children[0].childNodes[0];a.textContent=a.textContent.slice(0,-this.IME_KEY.length)}else if("richBox"===r){var o=n.previousSibling.lastChild.children[0].childNodes[0];o.textContent=o.textContent.slice(0,-this.IME_KEY.length)}}}},{key:"resetIME",value:function(e){" "===e&&(e=" "),e||(e="");var t=window.getSelection(),i=t.focusNode,n=i.parentNode.parentNode;"richMark"===((null==n?void 0:n.getAttribute("data-set-richType"))||"")&&(i.textContent=i.textContent.slice(0,t.focusOffset-this.IME_KEY.length-e.length)+e+i.textContent.slice(t.focusOffset),i.textContent=i.textContent.replace(new RegExp(this.ZERO_WIDTH_KEY,"g"),""),this.setCursorPos(i,this.pointEndIME+e.length))}},{key:"delTag",value:function(e){var t=e.previousSibling,i=e.nextSibling;e.parentNode.removeChild(e),this.markMerge(t,i)}},{key:"gridMerge",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"richMark"!==e.lastChild.getAttribute("data-set-richType")&&e.appendChild(this.getGridElm(!0)),"richMark"!==t.childNodes[0].getAttribute("data-set-richType")&&t.insertBefore(this.getGridElm(!0),t.childNodes[0]);var n=e.lastChild.childNodes[0],r=n.childNodes[0],a=r.textContent.length;Array.prototype.forEach.call(t.childNodes,(function(t){e.appendChild(t.cloneNode(!0))})),t.childNodes.length>1&&n.childNodes[1]&&n.removeChild(n.childNodes[1]);var o=n.parentNode.nextSibling;if(o){var s=o.children[0].childNodes[0];s&&s.textContent!==this.VOID_KEY&&(n.childNodes[1]&&n.removeChild(n.childNodes[1]),r.textContent=(r.textContent+s.textContent).replace(new RegExp(this.VOID_KEY,"g"),(function(){return a--,""})),r.parentElement.setAttribute("data-set-empty","false")),e.removeChild(o)}if(""===r.textContent&&(r.textContent=this.VOID_KEY,r.parentNode.setAttribute("data-set-empty","true"),a=1),i){var c=e.childNodes[e.childNodes.length-1].childNodes[0].childNodes[0];this.restCursorPos(c,c.textContent.length)}else this.richText.removeChild(t),this.restCursorPos(r,a);this.viewIntoPoint()}},{key:"markMerge",value:function(e,t){var i=e.children[0].childNodes[0],n=i.textContent.length;if(t){var r=t.children[0].childNodes[0];r&&r.textContent!==this.VOID_KEY&&(i.textContent=(i.textContent+r.textContent).replace(new RegExp(this.VOID_KEY,"g"),(function(){return n--,""})),i.parentElement.setAttribute("data-set-empty","false")),t.parentNode.removeChild(t)}""===i.textContent&&(i.textContent=this.VOID_KEY,i.parentNode.setAttribute("data-set-empty","true"),n=1);var a=e.parentNode;i.textContent===this.VOID_KEY&&e===a.lastChild&&(i.parentNode.appendChild(document.createElement("br")),i.parentNode.setAttribute("data-set-empty","true"),n=1),this.restCursorPos(i,n)}},{key:"setCallSpace",value:function(e){this.needCallSpace=e}},{key:"getWrapNode",value:function(e){if(e.nodeType===Node.TEXT_NODE)return e.parentNode.parentNode.parentNode;switch(e.getAttribute("data-set-richType")){case"richInput":return e.parentNode.parentNode;case"richMark":return e.parentNode;case"richBox":return e}}},{key:"getMarkNode",value:function(e){if(e.nodeType===Node.TEXT_NODE)return e.parentNode.parentNode;switch(e.getAttribute("data-set-richType")){case"richInput":return e.parentNode;case"richMark":return e}}},{key:"getRichTextNodeIndex",value:function(e){var t=this.getMarkNode(e),i=t.parentNode;return{gridIndex:Array.prototype.indexOf.call(this.richText.childNodes,i),markIndex:Array.prototype.indexOf.call(i.childNodes,t)}}},{key:"setWrapNodeByMark",value:function(e){var t=document.createElement("p");return t.className="chat-grid-wrap",t.setAttribute("data-set-richType","richBox"),Array.prototype.forEach.call(e,(function(e){t.appendChild(e)})),t}},{key:"setRangeLastText",value:function(){var e=this.richText.childNodes[this.richText.childNodes.length-1],t=e.childNodes[e.childNodes.length-1].children[0].childNodes[0];this.restCursorPos(t,t.textContent===this.VOID_KEY?1:t.textContent.length),this.viewIntoPoint()}},{key:"viewIntoPoint",value:function(){var e=window.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0).getBoundingClientRect(),i=this.richText.parentElement;i.scrollTop=t.top+i.scrollTop-i.clientHeight/2}}}])}(),d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;return new Promise((function(t){setTimeout(t,e)}))},u=function(e,t,i,n){var r=Object.assign(Object.assign({},{precision:"first",continuous:!1,space:"ignore",lastPrecision:"start",insensitive:!0}),n||{});return r.insensitive&&(e=e.toLowerCase(),i=i.toLowerCase()),"ignore"===r.space&&(i=i.replace(/\s/g,"")),p(e,t,i,r)||[]},p=function(e,t,i,n){for(var r,a=[],o=function(){if("ignore"===n.space&&" "===e[s])return a.push(s),0;if(e[s]===i[0])return i=i.slice(1),a.push(s),0;var r=t.split(" "),o=0;return r.forEach((function(e){var t=f(e,i);t>o&&(o=t)})),o&&(i=i.slice(o),a.push(s)),i?void 0:1},s=0;s<e.length&&(0===(r=o())||1!==r);s++);if(i)return null;if(n.continuous){var c=a;if(a.some((function(e,t){return t>0&&e!==c[t-1]+1})))return null}return"ignore"===n.space&&(a=a.filter((function(t){return" "!==e[t]}))),a.length?a:null},f=function(e,t){for(var i=0,n=0;n<e.length;n++)e[n]===t[i]&&i++;return i};var m=function(e){return Object.prototype.toString.call(e).slice(8,-1)},g=function(e,t){var i=m(e).toLowerCase();switch(m(t)){case"String":return i===t.toLowerCase();case"Array":return t.some((function(e){return i===e.toLowerCase()}));default:return!0}},v=function(){return o((function i(a){var o=this,c=a.elm,h=a.userList,u=a.placeholder,p=a.copyType,f=a.uploadImage,m=a.needCallEvery,g=a.callEveryLabel,v=a.userProps,y=a.needCallSpace,x=a.wrapKeyFun,E=a.sendKeyFun,b=a.needDialog,k=a.maxLength;if(r(this,i),s(this,"richText"),s(this,"needCallEvery",!0),s(this,"callEveryLabel","所有人"),s(this,"maxLength"),s(this,"textLength",0),s(this,"needDialog",!0),s(this,"placeholderElm"),s(this,"userProps",{id:"id",name:"name",avatar:"avatar",pinyin:"pinyin"}),s(this,"chat"),s(this,"targetUserList",[]),s(this,"userList",[]),s(this,"copyType",["text"]),s(this,"itemShowList",[]),s(this,"checkboxRows",[]),s(this,"base64Images",{}),s(this,"uploadImage"),s(this,"deviceInfo",function(){var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),o=/(?:iPhone)/.test(e)&&!a;return{isTablet:a,isPhone:o,isAndroid:n,isPc:!o&&!n&&!i}}()),s(this,"isComposition",!1),s(this,"undoHistory",[]),s(this,"redoHistory",[]),s(this,"doOverHistory",!0),s(this,"isExternalCallPopup",!1),s(this,"isIMEModel",!1),s(this,"chatEventModule",{enterSend:[],operate:[],defaultAction:[]}),s(this,"wrapKeyFun",(function(e){return e.ctrlKey&&["Enter"].includes(e.key)})),s(this,"sendKeyFun",(function(e){return!e.ctrlKey&&["Enter"].includes(e.key)})),s(this,"startOpenIndex",0),s(this,"toolUserList"),s(this,"dialogElm"),s(this,"dialogCheckElm"),s(this,"dialogMainElm"),s(this,"checkboxElm"),s(this,"searchResultElm"),s(this,"checkGroupElm"),s(this,"searchElm"),s(this,"tagsElm"),s(this,"dialogActiveItemElm"),s(this,"searchEmptyLabel","没有匹配到任何结果"),s(this,"checkAllLabel","全选"),s(this,"dialogH5Elm"),s(this,"dialogH5MainElm"),s(this,"dialogH5CheckElm"),s(this,"dialogH5ShowElm"),s(this,"dialogH5SearchElm"),s(this,"winClick",(function(){o.getElmBlock(o.dialogElm)&&o.exitDialog(),o.searchResultElm&&o.domElmShow(o.searchResultElm)})),s(this,"winKeydown",function(){var i=n(e().mark((function i(n){var r;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.ctrlKey&&"KeyZ"===n.code&&n.preventDefault(),!o.getElmBlock(o.dialogElm)||0===o.itemShowList.length||o.isComposition){e.next=20;break}if("ArrowDown"!==n.code){e.next=4;break}return o.moveActiveItem("down"),e.abrupt("return");case 4:if("ArrowUp"!==n.code){e.next=7;break}return o.moveActiveItem("up"),e.abrupt("return");case 7:if("Enter"!==n.code&&"NumpadEnter"!==n.code||!o.dialogActiveItemElm){e.next=20;break}return n.preventDefault(),r=o.dialogActiveItemElm.getAttribute("data-set-id")||"",e.next=12,d(100);case 12:if(!(o.toolUserList&&o.toolUserList.length>0)){e.next=17;break}return e.next=15,o.matchSetTag(o.userList.find((function(e){return e.id===r})));case 15:e.next=19;break;case 17:return e.next=19,o.onceSetTag("isALL"===r?t(t({},o.userProps.id,"isALL"),o.userProps.name,o.callEveryLabel):o.userList.find((function(e){return e.id===r})));case 19:o.exitDialog();case 20:case"end":return e.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),!(c instanceof HTMLElement))throw new Error("参数值elm：参数类型错误, 参数类型应为HTMLElement！");["absolute","relative","fixed"].includes(c.style.position)||(c.style.position="relative"),c.className+=" chat-area-".concat(this.deviceInfo.isPc?"pc":"h5"),this.richText=document.createElement("div"),this.richText.setAttribute("class","chat-rich-text"),this.richText.setAttribute("data-set-richType","richAllBox"),this.richText.setAttribute("contenteditable","true"),c.appendChild(this.richText),this.placeholderElm=document.createElement("div"),this.placeholderElm.className="chat-placeholder-wrap",this.domElmShow(this.placeholderElm,!0),c.appendChild(this.placeholderElm),this.chat=new l(this.richText),g&&(this.callEveryLabel=g),void 0!==b&&(this.needDialog="false"!==String(b)),this.needDialog&&(this.deviceInfo.isPc?this.hasPc():this.hasH5()),this.registerEvent(),this.updateConfig({userList:h,placeholder:u,maxLength:k,copyType:p,uploadImage:f,needCallEvery:m,needCallSpace:y,userProps:v,wrapKeyFun:x,sendKeyFun:E});var C={html:this.richText.innerHTML,gridIndex:0,markIndex:0,cursorIndex:this.chat.cursorIndex};this.undoHistory=[C]}),[{key:"registerEvent",value:function(){var t=this;this.richText.addEventListener("keyup",(function(e){if(t.needDialog){if(e.stopPropagation(),t.deviceInfo.isPc)return(50===e.keyCode||"Digit2"===e.code||"@"===e.key)&&t.ruleChatEvent(t.ruleCanShowPointDialog,"defaultAction","KEYBOARD_PRESS_@"),void(["ArrowDown","ArrowUp","ArrowLeft","ArrowRight"].includes(e.code)&&!t.getElmBlock(t.dialogElm)&&t.ruleChatEvent(t.ruleCanShowPointDialog,"defaultAction","KEYBOARD_MOVE_@"));var i=!1;switch("Unidentified"===e.key?"android":"ios"){case"android":i=229===e.keyCode;break;case"ios":i=50===e.keyCode||"Digit2"===e.code||"@"===e.key}i&&t.userList.length>0&&t.chat.showAt()&&(t.showH5Dialog(),t.isExternalCallPopup=!1)}})),this.richText.addEventListener("keydown",function(){var i=n(e().mark((function i(n){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.deviceInfo.isPc||"Unidentified"!==n.key||229!==n.keyCode){e.next=3;break}return n.preventDefault(),t.isIMEModel=!0,t.chat.setIMESelection(),e.abrupt("return");case 3:if(!t.isIMEModel){e.next=5;break}return e.abrupt("return");case 5:if(!t.getElmBlock(t.dialogElm)){e.next=8;break}return["ArrowUp","ArrowDown","Enter","NumpadEnter"].includes(n.code)?n.preventDefault():["ArrowLeft","ArrowRight"].includes(n.code)&&t.exitDialog(),e.abrupt("return");case 8:if("Backspace"!==n.code&&"Backspace"!==n.key){e.next=16;break}if(e.t0=t.chat.selectRegionMerge()||t.chat.gridElmMerge()||t.chat.delMarkRule(),!e.t0){e.next=14;break}return n.preventDefault(),e.next=14,t.richTextInput();case 14:e.next=31;break;case 16:if(!t.wrapKeyFun(n)&&(t.deviceInfo.isPc||"Enter"!==n.key)){e.next=23;break}return n.preventDefault(),t.chat.setWrap(),e.next=21,t.richTextInput();case 21:e.next=31;break;case 23:if(!t.sendKeyFun(n)){e.next=30;break}return n.preventDefault(),e.next=27,d(100);case 27:t.enterSend(),e.next=31;break;case 30:["ArrowLeft","ArrowRight"].includes(n.code)?(n.preventDefault(),t.chat.switchRange(n.code)):n.ctrlKey&&"KeyA"===n.code?t.isEmpty()&&n.preventDefault():n.ctrlKey&&"KeyZ"===n.code?(n.preventDefault(),t.ruleChatEvent(t.undo,"defaultAction","UNDO")):n.ctrlKey&&"KeyY"===n.code&&(n.preventDefault(),t.ruleChatEvent(t.redo,"defaultAction","REDO"));case 31:-1===["Backspace","Shift","Tab","CapsLock","Control","Meta","Alt","ContextMenu","Enter","NumpadEnter","Escape","ArrowLeft","ArrowUp","ArrowRight","ArrowDown","Home","End","PageUp","PageDown","Insert","Delete","NumLock"].indexOf(n.key)&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&t.chat.selectRegionMerge();case 32:case"end":return e.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),this.richText.addEventListener("input",function(){var i=n(e().mark((function i(n){var r,a,o,s,c,l;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.isIMEModel){e.next=15;break}if(t.isIMEModel=!1,"deleteContentBackward"!==n.inputType){e.next=8;break}return e.next=5,d(50);case 5:t.chat.delMarkRuleIME(),e.next=9;break;case 8:"insertParagraph"===n.inputType?t.chat.wrapIME():t.chat.resetIME(n.data);case 9:return t.chat.upDataNodeOrIndex(),t.chat.updateGrid(),void 0!==t.maxLength&&t.ruleMaxLength(),t.showPlaceholder(),t.triggerChatEvent("operate"),e.abrupt("return");case 15:return e.next=17,t.richTextInput();case 17:if(!t.getElmBlock(t.dialogElm)||t.isComposition){e.next=32;break}if(r=t.chat.vnode.textContent,a=t.chat.cursorIndex,o=new RegExp("^([".concat(t.chat.ZERO_WIDTH_KEY).concat(t.chat.VOID_KEY,"])+$")),!(!r||o.test(r)||a<t.startOpenIndex)){e.next=22;break}return t.exitDialog(),e.abrupt("return");case 22:if(s=r.slice(t.startOpenIndex,a+1),c=String(s||""),!/\s{2,}/gi.test(c)){e.next=26;break}return t.exitDialog(),e.abrupt("return");case 26:if(c){e.next=29;break}return t.resizeUserTool(),t.showPCDialog(),e.abrupt("return");case 29:t.toolUserList||(t.toolUserList=t.userList),(l=t.searchUserList(c,t.toolUserList)).length>0?(t.updateUserList(l,!0),t.showPCDialog()):t.exitDialog();case 32:case"end":return e.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()),this.richText.addEventListener("copy",(function(e){e.preventDefault(),t.ruleChatEvent((function(){t.copyRange(e)}),"defaultAction","COPY")})),this.richText.addEventListener("cut",(function(e){e.preventDefault(),t.ruleChatEvent((function(){t.copyRange(e),t.removeRange()}),"defaultAction","CUT")})),this.richText.addEventListener("paste",(function(i){i.preventDefault(),t.ruleChatEvent((function(){var r=i.clipboardData.getData("text/plain");if("string"==typeof r&&""!==r){if(-1===t.copyType.indexOf("text"))return;var a=document.createElement("div");a.innerHTML=i.clipboardData.getData("application/my-custom-format")||"",t.chat.selectRegionMerge(),a.children[0]&&"richBox"===a.children[0].getAttribute("data-set-richType")?t.insertInsideHtml(a.innerHTML):(a.innerHTML=r,t.insertText(a.innerText)),a=null}else{if(-1===t.copyType.indexOf("image"))return;var o=(i.clipboardData||i.originalEvent.clipboardData).items||[];Array.prototype.forEach.call(o,function(){var i=n(e().mark((function i(n){var r,a,o;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==n.type.indexOf("image")){e.next=2;break}return e.abrupt("return");case 2:if(r=n.getAsFile(),!t.uploadImage){e.next=10;break}return e.next=6,t.uploadImage(r);case 6:a=e.sent,t.insertHtml('<img class="chat-img" src="'.concat(a,'" alt="" />')),e.next=12;break;case 10:(o=new FileReader).onload=function(e){t.insertHtml('<img class="chat-img" src="'.concat(e.target.result,'" alt="" />'))},o.readAsDataURL(r);case 12:case"end":return e.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}())}}),"defaultAction","PASTE")})),this.richText.addEventListener("blur",(function(e){t.chat.upDataNodeOrIndex()})),this.richText.addEventListener("focus",(function(e){t.chat.upDataNodeOrIndex()})),this.richText.addEventListener("click",n(e().mark((function i(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.chat.upDataNodeOrIndex(),e.next=3,d();case 3:t.ruleChatEvent(t.ruleCanShowPointDialog,"defaultAction","MOUSE_MOVE_@");case 4:case"end":return e.stop()}}),i)})))),this.richText.addEventListener("dragstart",(function(e){e.stopPropagation(),e.preventDefault()})),this.richText.addEventListener("dragover",(function(e){e.stopPropagation(),e.preventDefault()})),this.richText.addEventListener("drop",(function(e){e.stopPropagation(),e.preventDefault()})),this.richText.addEventListener("compositionstart",(function(){t.isComposition=!0})),this.richText.addEventListener("compositionend",(function(){t.isComposition=!1}))}},{key:"richTextInput",value:(f=n(e().mark((function t(){var i,n,r,a,o,s,c=arguments;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!(c.length>0&&void 0!==c[0])||c[0],this.chat.upDataNodeOrIndex(),this.deviceInfo.isPc&&this.chat.selectRegionMerge(),e.next=5,d(50);case 5:if(this.isComposition||this.chat.updateGrid(),(n=(this.richText.children[0]||{childNodes:[]}).childNodes[0])&&n.getAttribute&&"richMark"===n.getAttribute("data-set-richType")){e.next=10;break}return this.chat.textInnerHtmlInit(!0),this.showPlaceholder(),this.triggerChatEvent("operate"),e.abrupt("return");case 10:void 0!==this.maxLength&&this.ruleMaxLength(),this.showPlaceholder(),this.triggerChatEvent("operate"),i&&!this.isComposition&&(r=this.chat.getRichTextNodeIndex(this.chat.vnode),a=r.gridIndex,o=r.markIndex,s={html:this.richText.innerHTML,gridIndex:a,markIndex:o,cursorIndex:this.chat.cursorIndex},this.undoHistory.push(s),this.undoHistory.length>50&&this.undoHistory.shift());case 11:case"end":return e.stop()}}),t,this)}))),function(){return f.apply(this,arguments)})},{key:"copyRange",value:function(e){var t=window.getSelection();if(t.isCollapsed||t.rangeCount<=0)return e.clipboardData.setData("application/my-custom-format",""),void e.clipboardData.setData("text/plain","");var i=t.toString()||"",n=document.createElement("div");n.innerHTML=i;var r=n.innerText.replace(/\n\n/g,"\n");n=null,e.clipboardData.setData("text/plain",r);var a=t.anchorNode,o=t.focusNode;if(a!==o||a.nodeType!==Node.TEXT_NODE)if(a!==this.richText||o!==this.richText){var s=this.chat.getWrapNode(a),c=this.chat.getWrapNode(o),l=this.chat.getMarkNode(a),h=this.chat.getMarkNode(o),d=Array.prototype.indexOf.call(s.childNodes,l),u=Array.prototype.indexOf.call(c.childNodes,h);if(s===c&&s.parentNode===this.richText){var p=d>u,f=Array.prototype.filter.call(s.childNodes,(function(e,t){return p?t<d&&t>u:t>d&&t<u})).map((function(e){return e.cloneNode(!0)})),m=p?a.textContent.slice(0,t.anchorOffset):a.textContent.slice(t.anchorOffset),g=p?o.textContent.slice(t.focusOffset):o.textContent.slice(0,t.focusOffset),v=this.chat.getGridElm(!0),y=this.chat.getGridElm(!0);m&&(v.childNodes[0].innerHTML=m,v.childNodes[0].setAttribute("data-set-empty","false")),g&&(y.childNodes[0].innerHTML=g,y.childNodes[0].setAttribute("data-set-empty","false")),p?(f.unshift(y),f.push(v)):(f.unshift(v),f.push(y));var x=document.createElement("div"),E=this.chat.setWrapNodeByMark(f);return x.appendChild(E),e.clipboardData.setData("application/my-custom-format",x.innerHTML),void(x=null)}if(s.parentNode===this.richText&&c.parentNode===this.richText){var b=Array.prototype.indexOf.call(this.richText.childNodes,s),k=Array.prototype.indexOf.call(this.richText.childNodes,c),C=b>k,w=Array.prototype.filter.call(this.richText.childNodes,(function(e,t){return C?t<b&&t>k:t>b&&t<k})).map((function(e){return e.cloneNode(!0)})),N=C?a.textContent.slice(0,t.anchorOffset):a.textContent.slice(t.anchorOffset),T=C?o.textContent.slice(t.focusOffset):o.textContent.slice(0,t.focusOffset),L=this.chat.getGridElm(!0),A=this.chat.getGridElm(!0);N&&(L.childNodes[0].innerHTML=N,L.childNodes[0].setAttribute("data-set-empty","false")),T&&(A.childNodes[0].innerHTML=T,A.childNodes[0].setAttribute("data-set-empty","false"));var I=Array.prototype.filter.call(s.childNodes,(function(e,t){return C?t<d:t>d})).map((function(e){return e.cloneNode(!0)})),S=Array.prototype.filter.call(c.childNodes,(function(e,t){return C?t>u:t<u})).map((function(e){return e.cloneNode(!0)}));if(C){I.push(L),S.unshift(A);var O=this.chat.setWrapNodeByMark(I),M=this.chat.setWrapNodeByMark(S);w.push(O),w.unshift(M)}else{I.unshift(L),S.push(A);var D=this.chat.setWrapNodeByMark(I),H=this.chat.setWrapNodeByMark(S);w.unshift(D),w.push(H)}var P=document.createElement("div");return Array.prototype.forEach.call(w,(function(e){P.appendChild(e)})),e.clipboardData.setData("application/my-custom-format",P.innerHTML),void(P=null)}}else e.clipboardData.setData("application/my-custom-format",this.richText.innerHTML);else{var _=a.textContent.slice(t.anchorOffset,t.focusOffset);e.clipboardData.setData("application/my-custom-format",_)}}},{key:"removeRange",value:(p=n(e().mark((function t(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.getSelection().getRangeAt(0).deleteContents(),e.next=3,d(50);case 3:this.chat.updateGrid(),this.showPlaceholder();case 5:case"end":return e.stop()}}),t,this)}))),function(){return p.apply(this,arguments)})},{key:"updateUserList",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1?arguments[1]:void 0;e&&(this.userList=this.getRuleUserList(e)),t||(this.base64Images={}),this.needDialog&&(this.deviceInfo.isPc?this.updatePCUser():this.updateH5User())}},{key:"getRuleUserList",value:function(e){var t=this;if(!g(e,"Array"))throw new Error("参数值userList：类型值应为Array！");this.targetUserList=JSON.parse(JSON.stringify(e||[]));var i=Object.create(null);return i[this.userProps.id]="isALL",i[this.userProps.name]=this.callEveryLabel,this.targetUserList.unshift(i),(null==e?void 0:e.map((function(e,i){var n=e[t.userProps.id];if(!n&&0!==n)throw new Error("参数值userList：下标第".concat(i,"项").concat(t.userProps.id,"值异常！"));return e.name=String(e[t.userProps.name]||""),e.pinyin=String(e[t.userProps.pinyin]||""),e.id=String(n),e.avatar=String(e[t.userProps.avatar]||""),e})))||[]}},{key:"getElmBlock",value:function(e){return e&&"block"===e.style.display}},{key:"domElmShow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e&&(e.className=e.className.replace(/ chat-view-show| chat-view-hidden/g,""),t?(e.style.display="block",e.className+=" chat-view-show"):e.style.display="none")}},{key:"getUserHtmlTemplate",value:function(e,t){var i=this,n=document.createElement("span");if(n.setAttribute("class","call-user-dialog-item-sculpture ".concat(t.avatar?"is-avatar":"")),t.avatar){var r=new Image;r.alt="";var a=this.base64Images[t.id];a?r.src=a:(r.src=String(t.avatar),r.setAttribute("crossOrigin","Anonymous"),r.onload=function(){var e=document.createElement("canvas");e.width=48,e.height=48;var n=e.getContext("2d");n&&(n.drawImage(r,0,0,e.width,e.height),i.base64Images[t.id]=e.toDataURL("image/png",1))}),n.appendChild(r)}else n.innerHTML='<span style="transform: scale(0.75)">'.concat(t.name.slice(-2),"</span>");e.appendChild(n);var o=document.createElement("span");o.setAttribute("class","call-user-dialog-item-name"),o.innerHTML=t.name,e.appendChild(o)}},{key:"hasPc",value:function(){this.initCheckbox(),this.initCallUser(),window.addEventListener("click",this.winClick),window.addEventListener("keydown",this.winKeydown)}},{key:"initCheckbox",value:function(){var t=this;this.checkboxElm=document.createElement("div"),this.checkboxElm.setAttribute("class","checkbox-dialog"),this.domElmShow(this.checkboxElm),this.checkboxElm.innerHTML='\n      <div class="checkbox-dialog-container">\n        <div class="checkbox-dialog-container-header">\n            <span>选择要@的人</span>\n            <span class="checkbox-dialog-container-header-close">⛌</span>\n        </div>\n        <div class="checkbox-dialog-container-body">\n            <div class="checkbox-dialog-left-box">\n                <div class="checkbox-dialog-search">\n                    <input class="checkbox-dialog-search-input" placeholder="搜索人员名称" type="text">\n\n                    <div data-set-remark="搜索下拉" class="checkbox-dialog-search-group"></div>\n                </div>\n\n                <div data-set-remark="反显选取的人员" class="checkbox-dialog-tags"></div>\n\n                <div class="checkbox-dialog-option">\n                    <button class="checkbox-dialog-option-btn btn-submit">确定</button>\n                    <button class="checkbox-dialog-option-btn btn-close">取消</button>\n                </div>\n            </div>\n            \n            <div class="checkbox-dialog-right-box">\n                <div class="checkbox-dialog-right-box-title">研讨成员列表</div>\n\n                <div data-set-remark="多选人员列表" class="checkbox-dialog-check-group"></div>\n            </div>\n        </div>\n      </div>\n    ',document.body.appendChild(this.checkboxElm),this.checkGroupElm=this.checkboxElm.querySelector(".checkbox-dialog-check-group"),this.searchResultElm=this.checkboxElm.querySelector(".checkbox-dialog-search-group"),this.searchElm=this.checkboxElm.querySelector(".checkbox-dialog-search-input"),this.tagsElm=this.checkboxElm.querySelector(".checkbox-dialog-tags");var i=function(){t.domElmShow(t.checkboxElm),t.isExternalCallPopup=!1},r=this.checkboxElm.querySelector(".checkbox-dialog-container-header-close"),a=this.checkboxElm.querySelector(".btn-close");r.onclick=i,a.onclick=i,this.checkboxElm.querySelector(".btn-submit").onclick=n(e().mark((function n(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.batchSetTag(t.checkboxRows);case 2:i(),t.chat.viewIntoPoint();case 4:case"end":return e.stop()}}),n)}))),this.domElmShow(this.searchResultElm),this.searchResultElm.onclick=function(e){e.stopPropagation()},this.searchElm.onclick=function(e){e.stopPropagation()},this.searchElm.oninput=function(e){t.searchResultElm.innerHTML="";var i=String(e.target.value||"").replace(/'/g,"");if(i){var n=t.searchUserList(i),r=document.createDocumentFragment();if(n.forEach((function(e){var i=document.createElement("div");i.setAttribute("class","checkbox-dialog-check-item"),i.setAttribute("data-set-value",e.id);var n=document.createElement("div");n.setAttribute("class","checkbox-dialog-check-item-label"),t.getUserHtmlTemplate(n,e),i.appendChild(n),i.onclick=function(){t.domElmShow(t.searchResultElm);var e=i.getAttribute("data-set-value")||"";if(t.searchElm.value="",!t.checkboxRows.some((function(t){return t.id===e}))){var n=t.userList.find((function(t){return t.id===e}));n&&t.checkboxRows.push(n),Array.prototype.some.call(t.checkGroupElm.children,(function(i,n){return 0===n&&t.checkboxRows.length===t.userList.length?(i.className+=" checkbox-dialog-check-item-check",!1):i.getAttribute("data-set-value")===e?(i.className+=" checkbox-dialog-check-item-check",!0):void 0})),t.updateTags()}},r.appendChild(i)})),!n.length){var a=document.createElement("div");a.setAttribute("class","checkbox-dialog-search-empty"),a.innerText=t.searchEmptyLabel,r.appendChild(a)}t.searchResultElm.appendChild(r),t.domElmShow(t.searchResultElm,!0)}else t.domElmShow(t.searchResultElm)}}},{key:"searchUserList",value:function(e,t){return(t||this.userList).filter((function(t){return u(t.name,t.pinyin||"",e).length>0}))}},{key:"updateTags",value:function(){var e=this,t=this.checkboxRows.map((function(e){return e.id})),i=[],n=[];Array.prototype.forEach.call(this.tagsElm.children,(function(e){var r=e.getAttribute("data-set-value");-1===t.indexOf(r)?n.push(e):i.push(r)})),n.forEach((function(t){e.tagsElm.removeChild(t)}));var r=this.checkboxRows.filter((function(e){return-1===i.indexOf(e.id)}));if(r.length){var a=document.createDocumentFragment();r.forEach((function(t){var i=document.createElement("div");i.setAttribute("class","checkbox-dialog-tag-item"),i.setAttribute("data-set-value",t.id),i.innerHTML="\n        <span>".concat(t.name,"</span>\n      ");var n=document.createElement("span");n.setAttribute("class","checkbox-dialog-tag-item-close"),n.innerHTML="⛌",n.onclick=function(){var t=i.getAttribute("data-set-value");e.checkboxRows=e.checkboxRows.filter((function(e){return e.id!==t})),e.tagsElm.removeChild(i),Array.prototype.some.call(e.checkGroupElm.children,(function(e,i){return 0===i?(e.className=e.className.replace(/ checkbox-dialog-check-item-check/g,""),!1):e.getAttribute("data-set-value")===t?(e.className=e.className.replace(/ checkbox-dialog-check-item-check/g,""),!0):void 0}))},i.appendChild(n),a.appendChild(i)})),this.tagsElm.appendChild(a)}}},{key:"initCallUser",value:function(){var e=this;this.dialogElm=document.createElement("div"),this.dialogElm.setAttribute("class","call-user-dialog"),this.domElmShow(this.dialogElm);var t=document.createElement("div");t.setAttribute("class","call-user-dialog-header"),t.innerHTML='\n        <span class="call-user-dialog-header-title">群成员</span>\n    ',this.dialogCheckElm=document.createElement("span"),this.dialogCheckElm.setAttribute("class","call-user-dialog-header-check"),this.domElmShow(this.dialogCheckElm,this.userList.length>0),this.dialogCheckElm.innerText="多选",this.dialogCheckElm.onclick=function(){e.showPCCheckDialog(),e.isExternalCallPopup=!1},t.appendChild(this.dialogCheckElm),this.dialogElm.appendChild(t),this.dialogMainElm=document.createElement("div"),this.dialogMainElm.setAttribute("class","call-user-dialog-main"),this.dialogElm.appendChild(this.dialogMainElm),this.updateUserList();var i=document.createElement("div");i.setAttribute("class","call-user-dialog-footer"),this.dialogElm.appendChild(i),document.body.appendChild(this.dialogElm)}},{key:"resizeUserTool",value:function(){this.toolUserList&&(this.userList=this.toolUserList),this.toolUserList=void 0,this.updateUserList(this.userList,!0)}},{key:"updatePCUser",value:function(){var e=this;this.dialogMainElm.innerHTML="",this.dialogActiveItemElm=void 0;var i=this.userList&&this.userList.length>0,n=document.createDocumentFragment();if(this.domElmShow(this.dialogCheckElm),!this.toolUserList&&i&&(this.domElmShow(this.dialogCheckElm,!0),this.needCallEvery)){var r=document.createElement("div");r.setAttribute("class","call-user-dialog-item"),r.setAttribute("data-set-id","isALL"),this.userSelectStyleAndEvent(r,t(t({},this.userProps.id,"isALL"),this.userProps.name,this.callEveryLabel)),r.innerHTML='\n          <span class="call-user-dialog-item-sculpture">\n            <span style="transform: scale(0.75)">@</span>\n          </span>\n          <span class="call-user-dialog-item-name">'.concat(this.callEveryLabel,"(").concat(this.userList.length,")</span>\n      "),n.appendChild(r)}this.userList.forEach((function(t){var i=document.createElement("div");i.setAttribute("class","call-user-dialog-item"),i.setAttribute("data-set-id",t.id),e.userSelectStyleAndEvent(i,t),e.getUserHtmlTemplate(i,t),n.appendChild(i)})),this.dialogMainElm.appendChild(n),this.callUserDialogMap(),this.checkGroupElm.innerHTML='\n                    <div class="checkbox-dialog-check-item" data-set-value="ALL">\n                        <input type="checkbox" value>\n                        <span class="checkbox-dialog-check-item-inner"></span>\n                        <div class="checkbox-dialog-check-item-label">'.concat(this.checkAllLabel,"</div>\n                    </div>");var a=document.createDocumentFragment();this.userList.forEach((function(t){var i=document.createElement("div");i.setAttribute("class","checkbox-dialog-check-item"),i.setAttribute("data-set-value",t.id),i.innerHTML='\n          <input type="checkbox" value>\n          <span class="checkbox-dialog-check-item-inner"></span>\n      ',e.getUserHtmlTemplate(i,t),a.appendChild(i)})),this.checkGroupElm.appendChild(a),this.checkGroupElm&&this.checkGroupElm.children.length&&Array.prototype.forEach.call(this.checkGroupElm.children,(function(t){t.onclick=function(){var i=t.getAttribute("data-set-value")||"",n=e.userList.find((function(e){return e.id===i}));-1!==t.className.indexOf("checkbox-dialog-check-item-check")?(t.className=t.className.replace(/ checkbox-dialog-check-item-check/g,""),"ALL"!==i&&(e.checkboxRows=e.checkboxRows.filter((function(e){return e.id!==i})))):(t.className+=" checkbox-dialog-check-item-check","ALL"!==i&&n&&e.checkboxRows.push(n)),"ALL"===i?(Array.prototype.forEach.call(e.checkGroupElm.children,(function(e){e.className=t.className})),e.checkboxRows=-1!==t.className.indexOf("checkbox-dialog-check-item-check")?e.userList.map((function(e){return e})):[]):e.checkboxRows.length===e.userList.length?e.checkGroupElm.children[0].className+=" checkbox-dialog-check-item-check":e.checkGroupElm.children[0].className=e.checkGroupElm.children[0].className.replace(/ checkbox-dialog-check-item-check/g,""),e.updateTags()}}))}},{key:"userSelectStyleAndEvent",value:function(t,i){var r=this;t.addEventListener("click",function(){var a=n(e().mark((function n(a){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.stopPropagation(),r.upDateActiveItem(t),!(r.toolUserList&&r.toolUserList.length>0)){e.next=7;break}return e.next=5,r.matchSetTag(i);case 5:e.next=9;break;case 7:return e.next=9,r.onceSetTag(i);case 9:r.exitDialog();case 10:case"end":return e.stop()}}),n)})));return function(e){return a.apply(this,arguments)}}())}},{key:"callUserDialogMap",value:function(){var e=this;this.itemShowList=[],Array.prototype.forEach.call(this.dialogMainElm.children||[],(function(t,i){e.itemShowList.push({index:i,elm:t})}))}},{key:"ruleCanShowPointDialog",value:function(){this.userList.length>0&&this.chat.showAt()&&(this.startOpenIndex=this.chat.cursorIndex,this.showPCDialog())}},{key:"showPCDialog",value:function(){this.domElmShow(this.dialogElm,!0);var e="0",t="100%";this.upDateActiveItem(this.dialogMainElm.firstElementChild,!0);var i=this.chat.getRangeRect(),n=this.dialogElm,r=n.clientWidth,a=n.clientHeight;i.x>window.innerWidth-r&&(i.x=i.x-r-16,e="100%"),i.y<a&&(i.y=a+i.y,t="0"),this.dialogElm.style.transformOrigin="".concat(e," ").concat(t),this.dialogElm.style.left=i.x+6+"px",this.dialogElm.style.bottom="calc(100% - ".concat(i.y,"px)"),this.dialogElm.style.opacity="1"}},{key:"showPCCheckDialog",value:function(){this.winClick(),this.checkboxRows=[],this.domElmShow(this.checkboxElm,!0),this.tagsElm.scrollTop=0,this.checkGroupElm.scrollTop=0,this.searchElm.value="",Array.prototype.forEach.call(this.checkGroupElm.children,(function(e){e.className="checkbox-dialog-check-item"})),this.updateTags(),this.isExternalCallPopup=!0}},{key:"showPCPointDialog",value:(h=n(e().mark((function t(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.insertText("@"),this.startOpenIndex=this.chat.cursorIndex,window.removeEventListener("click",this.winClick),this.showPCDialog(),e.next=6,d(50);case 6:window.addEventListener("click",this.winClick);case 7:case"end":return e.stop()}}),t,this)}))),function(){return h.apply(this,arguments)})},{key:"moveActiveItem",value:function(e){if(this.dialogActiveItemElm&&0!==this.itemShowList.length){var t=0,i=this.dialogActiveItemElm.getAttribute("data-set-id");this.itemShowList.some((function(e){var n=e.elm.getAttribute("data-set-id");return t=e.index,i===n}));var n=this.itemShowList.map((function(e){return e.index}));if("down"===e&&t!==this.itemShowList[this.itemShowList.length-1].index){var r=this.itemShowList[n.indexOf(t)+1];r&&this.upDateActiveItem(r.elm,!0)}else if("up"===e&&t!==this.itemShowList[0].index){var a=this.itemShowList[n.indexOf(t)-1];a&&this.upDateActiveItem(a.elm,!0)}}}},{key:"upDateActiveItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.dialogActiveItemElm&&(this.dialogActiveItemElm.className=this.dialogActiveItemElm.className.replace(/ call-user-dialog-item-active/g,"")),this.dialogActiveItemElm=e,e&&(e.className+=" call-user-dialog-item-active",t&&e.scrollIntoView({block:"center"}))}},{key:"exitDialog",value:function(){this.toolUserList&&this.resizeUserTool(),this.upDateActiveItem(),this.domElmShow(this.dialogElm)}},{key:"hasH5",value:function(){var i=this;this.dialogH5Elm=document.createElement("div"),this.dialogH5Elm.setAttribute("class","call-user-popup"),this.dialogH5Elm.innerHTML='\n      <div class="call-user-popup-main">\n        <div class="call-user-popup-header">\n            <span class="popup-show">收起</span>\n            <span class="popup-title">选择提醒的人</span>\n            <span class="popup-check">确定</span>\n        </div>\n        \n        <div class="call-user-popup-search">\n            <svg class="icon-search"\n                 style="vertical-align: middle;fill: currentColor;overflow: hidden;"\n                 viewBox="0 0 1024 1024" version="1.1"\n                 xmlns="http://www.w3.org/2000/svg"\n                 p-id="4209">\n                <path d="M684.8 223.530667a326.272 326.272 0 0 1 24.96 433.621333c2.645333 2.133333 5.290667 4.48 7.850667 7.04L870.4 817.066667c24.789333 24.746667 32.896 56.832 18.133333 71.594666-14.762667 14.805333-46.848 6.656-71.637333-18.090666l-152.789333-152.832a106.282667 106.282667 0 0 1-7.210667-7.936 326.101333 326.101333 0 0 1-433.109333-25.173334c-127.445333-127.445333-127.573333-333.952-0.256-461.269333 127.36-127.36 333.866667-127.232 461.269333 0.213333zM275.328 275.114667a252.885333 252.885333 0 0 0 0.256 357.632 252.885333 252.885333 0 0 0 357.632 0.256 252.885333 252.885333 0 0 0-0.256-357.632 252.885333 252.885333 0 0 0-357.632-0.256z"\n                      fill="#9B9B9B"\n                      p-id="4210"></path>\n            </svg>\n            <input class="call-user-popup-search-input"\n                   placeholder="搜索人员名称"\n                   type="text">\n        </div>\n        \n        <div class="call-user-popup-body">\n        </div>\n      </div>\n    ';var r=function(){var t=n(e().mark((function t(){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i.dialogH5Elm.className=i.dialogH5Elm.className.replace(/ chat-view-show/g," chat-view-hidden"),i.dialogH5SearchElm.value="",e.next=4,d(260);case 4:i.domElmShow(i.dialogH5Elm),i.chat.restCursorPos(i.chat.vnode,i.chat.cursorIndex),i.isExternalCallPopup=!1,i.chat.viewIntoPoint();case 8:case"end":return e.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();this.dialogH5Elm.onclick=r,this.dialogH5Elm.querySelector(".call-user-popup-main").onclick=function(e){e.stopPropagation()},this.dialogH5ShowElm=this.dialogH5Elm.querySelector(".popup-show"),this.dialogH5ShowElm.onclick=r,this.dialogH5CheckElm=this.dialogH5Elm.querySelector(".popup-check"),this.dialogH5CheckElm.onclick=n(e().mark((function n(){var a,o,s;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(a=i.dialogH5Elm.querySelectorAll(".user-popup-check-item-check")||[]).length){e.next=5;break}return e.next=4,r();case 4:case 10:return e.abrupt("return");case 5:if(!Array.prototype.some.call(a,(function(e){return"isALL"===e.getAttribute("data-set-id")}))){e.next=11;break}return e.next=8,i.onceSetTag(t(t({},i.userProps.id,"isALL"),i.userProps.name,i.callEveryLabel));case 8:return e.next=10,r();case 11:return o=Array.prototype.map.call(a,(function(e){return e.getAttribute("data-set-id")})),s=i.userList.filter((function(e){return o.includes(e.id)})),e.next=14,i.batchSetTag(s);case 14:return e.next=16,r();case 16:case"end":return e.stop()}}),n)}))),this.dialogH5MainElm=this.dialogH5Elm.querySelector(".call-user-popup-body"),this.updateUserList(),this.dialogH5SearchElm=this.dialogH5Elm.querySelector(".call-user-popup-search-input"),this.dialogH5SearchElm.oninput=function(e){var t=String(e.target.value||"").replace(/'/g,"");Array.prototype.forEach.call(i.dialogH5MainElm.children,(function(e){if(t){var i=e.getAttribute("data-set-name")||"",n=e.getAttribute("data-set-pinyin")||"";e.style.display=u(i,n,t).length>0?"":"none"}else e.style.display=""}))},this.domElmShow(this.dialogH5Elm),document.body.appendChild(this.dialogH5Elm)}},{key:"updateH5User",value:function(){var e=this;this.dialogH5MainElm.innerHTML="",this.domElmShow(this.dialogH5CheckElm,this.userList.length>0);var t=this.userList&&this.userList.length>0,i=document.createDocumentFragment(),n=document.createElement("span");if(n.innerHTML='\n        <input type="checkbox" value>\n        <span class="user-popup-check-item-inner"></span>\n    ',t){var r=document.createElement("div");this.needCallEvery&&(r.setAttribute("class","call-user-popup-item"),r.setAttribute("data-set-id","isALL"),r.innerHTML='\n          <span class="call-user-dialog-item-sculpture">\n            <span style="transform: scale(0.75)">@</span>\n          </span>\n          <span class="call-user-dialog-item-name">'.concat(this.callEveryLabel,"(").concat(this.userList.length,")</span>\n      "),r.appendChild(n.cloneNode(!0)),r.onclick=function(){var t=-1===r.className.indexOf("user-popup-check-item-check");Array.prototype.forEach.call(e.dialogH5MainElm.children,(function(e){t?e.className+=" user-popup-check-item-check":e.className=e.className.replace(/ user-popup-check-item-check/g,"")}))},i.appendChild(r)),this.userList.forEach((function(t,a){var o=document.createElement("div");o.setAttribute("class","call-user-popup-item"),o.setAttribute("data-set-id",t.id),o.setAttribute("data-set-name",t.name),o.setAttribute("data-set-pinyin",t.pinyin||""),e.getUserHtmlTemplate(o,t),o.appendChild(n.cloneNode(!0)),i.appendChild(o),o.onclick=function(t){-1===o.className.indexOf("user-popup-check-item-check")?(o.className+=" user-popup-check-item-check",r.className+=Array.prototype.every.call(e.dialogH5MainElm.children,(function(e){return-1!==e.className.indexOf("user-popup-check-item-check")||"isALL"===e.getAttribute("data-set-id")}))?" user-popup-check-item-check":""):(o.className=o.className.replace(/ user-popup-check-item-check/g,""),r.className=r.className.replace(/ user-popup-check-item-check/g,""))}}))}this.dialogH5MainElm.appendChild(i)}},{key:"showH5Dialog",value:function(){this.richText&&this.richText.blur(),Array.prototype.forEach.call(this.dialogH5MainElm.children,(function(e){e.style.display="",e.className=e.className.replace(/ user-popup-check-item-check/g,"")})),this.domElmShow(this.dialogH5Elm,!0),this.dialogH5MainElm.scrollTop=0,this.isExternalCallPopup=!0}},{key:"updateConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.copyType,i=e.userProps,n=e.userList,r=e.uploadImage,a=e.needCallEvery,o=e.placeholder,s=e.maxLength,c=e.needCallSpace,l=e.wrapKeyFun,h=e.sendKeyFun;if(t){if(!g(t,"Array"))throw new Error("参数值copyType：类型值应为Array！");this.copyType=t.map((function(e){if(-1===["text","image"].indexOf(e))throw new Error('参数值copyType：无效的参数值"'.concat(e,'"！'));return e}))}if(i){if(!g(i,"Object"))throw new Error("参数值copyType：类型值应为Object！");this.userProps=Object.assign({},{id:"id",name:"name",avatar:"avatar",pinyin:"pinyin"},i)}if(r){if("function"!=typeof r)throw new Error("参数值uploadImage：参数类型错误，参数类型应为Function！");this.uploadImage=r}if(o&&(this.placeholderElm.innerText=o),void 0!==s){if(!g(s,"Number"))throw new Error("参数值maxLength：类型值应为Number！");this.maxLength=s,this.ruleMaxLength()}if((void 0!==a||n)&&(this.needCallEvery="false"!==String(a),this.updateUserList(n)),void 0!==c&&this.chat.setCallSpace(c),l){if("function"!=typeof l)throw new Error("参数值wrapKeyFun：参数类型错误，参数类型应为Function！");this.wrapKeyFun=l}if(h){if("function"!=typeof h)throw new Error("参数值sendKeyFun：参数类型错误，参数类型应为Function！");this.sendKeyFun=h}}},{key:"enterSend",value:function(){this.triggerChatEvent("enterSend")}},{key:"insertHtml",value:function(e){var t=document.createElement("span");t.innerHTML=e,t.className="chat-set-html";var i=this.chat.createNewDom(t);return this.chat.replaceRegContent(i),this.chat.viewIntoPoint(),this.richTextInput(),i}},{key:"insertInsideHtml",value:function(e){var t=this,i=document.createElement("div");if(i.innerHTML=e,i.children.length){var n=this.chat.vnode,r=this.chat.getWrapNode(n);if(1===i.children.length)this.chat.gridMerge(r,i.children[0],!0);else{this.chat.gridMerge(r,i.children[0],!0);var a=Array.prototype.slice.call(i.children,1),o=r;Array.prototype.forEach.call(a,(function(e,i){if(o.parentElement?t.richText.insertBefore(e,o.nextElementSibling):t.richText.appendChild(e),o=e,i===a.length-1){var n=e.childNodes[e.childNodes.length-1].childNodes[0].childNodes[0];t.chat.restCursorPos(n,n.textContent.length)}}))}i=null,this.chat.viewIntoPoint(),this.richTextInput()}}},{key:"insertText",value:function(e){var t,i,n=this;if(e){var r=new RegExp("".concat(this.chat.ZERO_WIDTH_KEY).concat(this.chat.VOID_KEY),"ig"),a=e.replace(r,"");if(a){var o,s=0,c=this.chat.vnode;c&&c.parentElement&&"richInput"===c.parentElement.getAttribute("data-set-richType")?(o=c.parentElement,s=c.textContent===this.chat.VOID_KEY?1:this.chat.cursorLeft):(o=null==(i=null==(t=this.richText)?void 0:t.lastChild)?void 0:i.lastChild,s=o.childNodes[0].textContent.length);var l,h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=o.childNodes[0],r=i.textContent.split("");return r.splice(s,0,e),i.textContent=r.join("").replace(new RegExp(n.chat.VOID_KEY,"g"),(function(){return s--,""})),o.setAttribute("data-set-empty","false"),o.childNodes[1]&&o.removeChild(o.childNodes[1]),n.chat.restCursorPos(i,s+e.length),t&&n.chat.viewIntoPoint(),o.parentElement.parentElement},d=a.split("\n");if(d.length>1)d.forEach((function(e,t){l=0===t?h(e):function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0,r=n.chat.getGridElm(),a=r.childNodes[0].childNodes[0],o=1;return e&&(a.innerHTML=e,a.setAttribute("data-set-empty","false"),o=e.length),i.nextSibling?n.richText.insertBefore(r,i.nextSibling):n.richText.appendChild(r),t&&(n.chat.restCursorPos(a.childNodes[0],o),n.chat.viewIntoPoint()),r}(e,t===d.length-1,l)}));else h(a,!0);this.richTextInput()}}}},{key:"getCallUserList",value:function(){var e=this.richText.querySelectorAll(".at-user");if(e&&e.length>0){var t=Array.prototype.map.call(e,(function(e){return e.dataset.userId}));return function(e,t,i){return e.forEach((function(e){if(i in e){var n=t.indexOf(String(e[i]));-1!==n&&(t[n]=e)}})),t.filter((function(e){return e[i]}))}(this.targetUserList,t,this.userProps.id)}return[]}},{key:"getCallUserTagList",value:function(){var e=this,i=this.richText.querySelectorAll(".at-user");return i&&i.length>0?Array.prototype.map.call(i,(function(i){return t(t({},e.userProps.id,i.dataset.userId),e.userProps.name,i.innerText.slice(1))})):[]}},{key:"clear",value:function(e){this.chat.textInnerHtmlInit(!0,e);var t={html:this.richText.innerHTML,gridIndex:0,markIndex:0,cursorIndex:this.chat.cursorIndex};this.undoHistory=[t],this.redoHistory=[],this.richTextInput(!1)}},{key:"isEmpty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if((this.richText.querySelectorAll(".chat-tag")||[]).length>0)return!1;var t=new RegExp("^(".concat(this.chat.ZERO_WIDTH_KEY,"|<br>|").concat(this.chat.VOID_KEY,")+$")),i=this.richText.querySelectorAll(".chat-grid-input")||[];return e?Array.prototype.every.call(i,(function(e){return!e.innerHTML||!e.innerText||!e.innerText.trim()||t.test(e.innerHTML)})):Array.prototype.every.call(i,(function(e){return!e.innerHTML||!e.innerText||t.test(e.innerHTML)}))}},{key:"showPlaceholder",value:function(){this.domElmShow(this.placeholderElm,this.isEmpty())}},{key:"getReduceNode",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=Object.assign({},{needUserId:!1,wrapClassName:void 0,rowClassName:void 0,imgToText:!1,identifyLink:!1},t),n=/(https?|http|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/g,r=this.richText.cloneNode(!0).querySelectorAll(".chat-grid-wrap")||[],a=document.createElement("div");return i.wrapClassName&&(a.className=i.wrapClassName),Array.prototype.forEach.call(r,(function(t,r){var o=t.querySelectorAll(".chat-stat")||[],s=document.createElement("p");i.rowClassName&&(s.className=i.rowClassName),Array.prototype.forEach.call(o,(function(t){e.chat.getNodeEmpty(t)||(t.removeAttribute("data-set-richType"),t.removeAttribute("contenteditable"),t.removeAttribute("data-set-empty"),i.needUserId||t.removeAttribute("data-user-id"),i.imgToText&&t.firstChild&&"IMG"===t.firstChild.tagName&&(t.className+=" img-to-text",t.innerHTML="[".concat(t.firstChild.getAttribute("data-img-text")||"元素data-img-text未定义","]")),i.identifyLink&&-1!==t.className.indexOf("chat-grid-input")&&(t.innerHTML=t.innerHTML.replace(n,(function(e){return'<a class="chat-grid-link" href="'.concat(e,'" target="_blank">').concat(e,"</a>")}))),s.appendChild(t))})),s.innerHTML||(s.innerHTML="<br>"),a.appendChild(s)})),a}},{key:"getText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t="",i=this.getReduceNode(e);return Array.prototype.forEach.call(i.children,(function(e,i){t=t+(i>0?"\n":"")+e.textContent})),t}},{key:"getHtml",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.getReduceNode(e).innerHTML}},{key:"dispose",value:function(){var e=this.richText.parentElement;for(var t in e&&(e.removeChild(this.richText),e.removeChild(this.placeholderElm)),this.needDialog&&(this.deviceInfo.isPc?(document.body.removeChild(this.dialogElm),document.body.removeChild(this.checkboxElm),window.removeEventListener("click",this.winClick),window.removeEventListener("keydown",this.winKeydown)):document.body.removeChild(this.dialogH5Elm)),this)delete this[t];Object.setPrototypeOf(this,Object)}},{key:"setUserTag",value:function(e){var t=this.chat.createAtUserSpan({id:e[this.userProps.id],name:e[this.userProps.name]});this.chat.replaceRegContent(t,!1),this.chat.viewIntoPoint(),this.richTextInput()}},{key:"matchSetTag",value:(c=n(e().mark((function t(i){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chat.searchCall(i,this.startOpenIndex);case 2:return e.next=4,this.richTextInput();case 4:case"end":return e.stop()}}),t,this)}))),function(e){return c.apply(this,arguments)})},{key:"onceSetTag",value:(a=n(e().mark((function t(i){return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.chat.onceCall({id:i[this.userProps.id],name:i[this.userProps.name]});case 2:return e.next=4,this.richTextInput();case 4:case"end":return e.stop()}}),t,this)}))),function(e){return a.apply(this,arguments)})},{key:"batchSetTag",value:(i=n(e().mark((function t(i){var n,r,a;return e().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==i.length){e.next=9;break}if(!this.isExternalCallPopup){e.next=6;break}return e.next=4,this.chat.onceExternalCall(i[0]);case 4:e.next=8;break;case 6:return e.next=8,this.onceSetTag(i[0]);case 8:return e.abrupt("return");case 9:n="",r=0;case 11:if(!(r<=i.length-1)){e.next=36;break}if(a={id:i[r][this.userProps.id],name:i[r][this.userProps.name]},0!==r){e.next=26;break}if(!this.isExternalCallPopup){e.next=20;break}return e.next=17,this.chat.onceExternalCall(a);case 17:e.t0=e.sent,e.next=23;break;case 20:return e.next=22,this.chat.onceCall(a,!0);case 22:e.t0=e.sent;case 23:n=e.t0,e.next=33;break;case 26:if(r!==i.length-1){e.next=31;break}return e.next=29,this.chat.onceCall(a,!1,n);case 29:e.next=33;break;case 31:return e.next=33,this.chat.onceCall(a,!0);case 33:r++;case 34:e.next=11;break;case 36:return e.next=38,this.richTextInput();case 38:case"end":return e.stop()}}),t,this)}))),function(e){return i.apply(this,arguments)})},{key:"disabled",value:function(){this.richText.setAttribute("contenteditable","false"),this.richText.className=this.richText.className.replace(/ chat-rich-text-disabled/g,"")+" chat-rich-text-disabled"}},{key:"enable",value:function(){this.richText.setAttribute("contenteditable","true"),this.richText.className=this.richText.className.replace(/ chat-rich-text-disabled/g,""),this.chat.setRangeLastText()}},{key:"undo",value:function(){if(this.doOverHistory&&this.undoHistory&&!(this.undoHistory.length<=1)){var e=this.undoHistory[this.undoHistory.length-2],t=this.undoHistory[this.undoHistory.length-1];this.redoHistory.push(t),this.undoHistory.pop(),this.setChatHistory(e,!1)}}},{key:"redo",value:function(){if(this.doOverHistory&&this.redoHistory&&!(this.redoHistory.length<1)){var e=this.redoHistory[this.redoHistory.length-1];this.redoHistory.pop(),this.setChatHistory(e,!0)}}},{key:"ruleMaxLength",value:function(){var e=this;if(this.isEmpty()||void 0===this.maxLength)this.textLength=0;else{var t=0,i=0,n=[];Array.prototype.some.call(this.richText.children,(function(r,a){var o=e.getGirdNodeTextInfo(r),s=o.nodeInfos,c=o.nodeTextLength;if(t+=c,n.push(s),i=a,t>=e.maxLength)return!0}));var r=[];Array.prototype.forEach.call(this.richText.children,(function(e,t){t>i&&r.push(e)})),r.forEach((function(t){return e.richText.removeChild(t)})),this.deepDelGirdText(n,t)}}},{key:"getGirdNodeTextInfo",value:function(e){var t=this,i=[],n=0;if(1===e.children.length&&e!==e.parentElement.children[0]){var r=e.children[0],a=(r.textContent||"").replace(new RegExp(this.chat.VOID_KEY,"g"),"");n+=a.length||1,i[0]={node:r,textLength:a.length||1,type:"richMark"}}else Array.prototype.forEach.call(e.children,(function(e,r){if("richMark"===e.getAttribute("data-set-richType")){var a=(e.textContent||"").replace(new RegExp(t.chat.VOID_KEY,"g"),"");n+=a.length,i[r]={node:e,textLength:a.length,type:"richMark"}}else{var o=(e.textContent||"").replace(new RegExp(t.chat.VOID_KEY,"g"),"");n+=o.length||1,i[r]={node:e,textLength:o.length||1,type:"chatTag"}}}));return{nodeInfos:i,nodeTextLength:n}}},{key:"deepDelGirdText",value:function(e,t){if(t>this.maxLength){var i=e[e.length-1];e.pop(),this.deepDelNode(i,e,t)}else this.textLength=t}},{key:"deepDelNode",value:function(e,t,i){var n=e[0].node.parentElement;if(i>this.maxLength){var r=i-this.maxLength,a=e[e.length-1];if("richMark"===a.type)if(0===a.textLength||r>=a.textLength)n.removeChild(a.node),e.pop(),r-=a.textLength,a=e[e.length-1],n.removeChild(a.node),e.pop(),r-=a.textLength;else{var o=a.node.childNodes[0];o.textContent=o.textContent.slice(0,a.textLength-r),0===o.textContent&&(o.setAttribute("data-set-empty","true"),o.innerHTML="".concat(this.chat.VOID_KEY,"<br>")),r=0}else n.removeChild(a.node),e.pop(),r-=a.textLength;r>0?e.length>0?this.deepDelNode(e,t,r+this.maxLength):(this.richText.appendChild(n),this.deepDelGirdText(t,r+this.maxLength)):(this.textLength=this.maxLength+r,this.enable())}}},{key:"setChatHistory",value:function(e,t){var i=this;this.doOverHistory=!1;var n=e.html,r=e.gridIndex,a=e.markIndex,o=e.cursorIndex;this.richText.innerHTML=n;var s=this.richText.childNodes[r].childNodes[a].childNodes[0].childNodes[0];this.chat.restCursorPos(s,o),this.chat.viewIntoPoint(),this.richTextInput(t).then((function(){i.doOverHistory=!0}))}},{key:"revisePCPointDialogLabel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},{title:"群成员",checkLabel:"多选"},e);this.dialogElm.querySelector(".call-user-dialog-header-title").innerText=t.title,this.dialogCheckElm.innerText=t.checkLabel}},{key:"revisePCCheckDialogLabel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.assign({},{title:"选择要@的人",searchPlaceholder:"搜素人员名称",searchEmptyLabel:"没有匹配到任何结果",userTagTitle:"研讨成员列表",checkAllLabel:"全选",confirmLabel:"确定",cancelLabel:"取消"},e);this.checkboxElm.querySelector(".checkbox-dialog-container-header").children[0].innerText=t.title,this.searchElm.setAttribute("placeholder",t.searchPlaceholder||""),this.searchEmptyLabel=t.searchEmptyLabel||"",this.checkboxElm.querySelector(".checkbox-dialog-right-box-title").innerText=t.userTagTitle,this.checkAllLabel=t.checkAllLabel||"",this.checkGroupElm.children[0].children[2].innerText=this.checkAllLabel,this.checkboxElm.querySelector(".btn-submit").innerText=t.confirmLabel,this.checkboxElm.querySelector(".btn-close").innerText=t.cancelLabel}},{key:"reviseH5DialogLabel",value:function(e){var t=Object.assign({},{title:"选择提醒的人",searchPlaceholder:"搜素人员名称",confirmLabel:"确定",cancelLabel:"收起"},e);this.dialogH5Elm.querySelector(".popup-title").innerText=t.title,this.dialogH5SearchElm.setAttribute("placeholder",t.searchPlaceholder||""),this.dialogH5CheckElm.innerText=t.confirmLabel,this.dialogH5ShowElm.innerText=t.cancelLabel}},{key:"reverseAnalysis",value:function(e,t){var i=this,n=document.createElement("div");n.innerHTML=e;var r=n.children;Array.prototype.forEach.call(r,(function(e){e.className="chat-grid-wrap",e.setAttribute("data-set-richType","richBox");var t=e.children,n={},r=[];for(var a in Array.prototype.forEach.call(t,(function(a,o){if(-1!==a.className.indexOf("chat-grid-input")){var s=a.innerText;return a.className="",a.setAttribute("data-set-richType","richMark"),void(a.innerHTML='<span class="chat-grid-input chat-stat" data-set-richType="richInput" data-set-empty="false">'.concat(s,"</span>"))}if("BR"===a.tagName){var c=i.chat.getGridElm(!0);return e.removeChild(a),void e.appendChild(c)}var l=a.cloneNode(!0);l.setAttribute("contenteditable","false");var h=document.createElement("span");h.className="chat-tag",h.setAttribute("contenteditable","false"),h.setAttribute("data-set-richType","chatTag"),h.appendChild(l),n[o]=h,o!==t.length-1?-1===t[o+1].className.indexOf("chat-grid-input")&&r.push(o):r.push(o),0===o&&r.push(-1)})),n){var o=Number(a);o===t.length-1?(e.removeChild(t[o]),e.appendChild(n[a])):(e.insertBefore(n[a],t[o+1]),e.removeChild(t[o]))}var s=[],c=e.children;r.forEach((function(e){e===c.length-1?s.push("isEnd"):s.push(c[e+1])})),s.forEach((function(t){var n=i.chat.getGridElm(!0);if("isEnd"===t)e.appendChild(n);else{var r=n.children[0];r.removeChild(r.childNodes[1]),e.insertBefore(n,t)}}))})),t?(this.enable(),this.insertInsideHtml(n.innerHTML)):(this.richText.innerHTML=n.innerHTML,this.enable(),this.chat.viewIntoPoint(),this.richTextInput())}},{key:"addEventListener",value:function(e,t){this.chatEventModule[e].push(t)}},{key:"removeEventListener",value:function(e,t){var i=this.chatEventModule[e],n=i.indexOf(t);-1!==n&&i.splice(n,1)}},{key:"triggerChatEvent",value:function(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];var r;return this.chatEventModule[e].forEach((function(e){e&&(r?e.apply(void 0,i):r=e.apply(void 0,i))})),r}},{key:"ruleChatEvent",value:function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];"PREVENT"!==(this.triggerChatEvent.apply(this,[t].concat(n))+"").toUpperCase()&&(e&&e.bind(this)(),e=null)}}]);var i,a,c,h,p,f}();if(!window)throw new Error("非web环境！");window.console&&window.console.log&&console.log(" %c ".concat("ChatArea"," %c v4.6.3 "),"background: #269AFF; color: #FFFFFF; padding: 4px 0; border-radius: 4px 0px 0px 4px; font-style: italic;","background: #FFFFFF; color: #269AFF; padding: 2px 0; border-radius: 0px 4px 4px 0px; font-style: italic; border: 2px solid #269AFF;"),window.ChatArea=v;i("C",window.ChatArea)}}}))}();
